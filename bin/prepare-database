#!/bin/bash -e

echo "🔍 Checking database connection..."

# Wait for database to be ready
until bin/rails runner "ActiveRecord::Base.connection.execute('SELECT 1')" > /dev/null 2>&1; do
  echo "⏳ Waiting for database to be ready..."
  sleep 2
done

echo "✅ Database connection established!"

# Check if database exists, if not create it
echo "🔧 Preparing database..."
bin/rails db:prepare

echo "🚀 Database is ready!"
